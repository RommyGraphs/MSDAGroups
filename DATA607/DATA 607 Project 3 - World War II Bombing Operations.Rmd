---
title: "DATA 607 Project 3 - World War II Aerial Bombing Operations"
author: "Jason Givens-Doyle, Romerl Elizes & Soumya Ghosh"
date: "September 29, 2018"
output: 
  html_document: 
    toc: true
    df_print: kable
    theme: cerulean
    highlight: pygments
    css: ./lab.css
  #  code_folding:hide
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Project Summary

The team composed of Jason Givens-Doyle, Soumya Ghosh, and Romerl Elizes was formed at the start of the semester. After a week of individual research, the team decided to invest its time in the World War 2 Allied Bombing data found in Data.World. We held a weekly meeting since inception to make sure all goals and issues were satisfied in a timely manner. Because Jason lives in Japan, it was best if we all collaborated using Google Hangout as our primary communication tool. In the end, Soumya became the project manager and database guru, Jason was our maps expert, and Romerl developed relevant questions and analyzed them using the variety of R-tools. Romerl also developed the analysis and summary documentation. However, all team members corrected each others work as needed in order to bring this project out to its successful conclusion. 

**Which are the most valued data science skills?** Each of the individual team members come from different backgrounds and experiences. Each team member has his own individual strengths. As a team, the team members performed with elan. The team learned to trust each other and give generous input on what should be done for next week. Soumya and Jason all wanted to accomplish more tasks for each week, but Romerl wanted to make sure that the group objectives were completed in a timely manner before the deadline. The team imposed deadlines on itself and that helped keep the project moving at a sustainable pace. The team is fortunate in that it had no personality issues or concerns and accomplished much from its inception. The team joked around in the beginning of the team meetings, but got down to the business of accomplishing its objectives. The team exhibited some excellent soft skills that are quite important not only in a data science team environment, but for any project team:

- **Trust in One Another.** This is a very important characteristic. If not for trust, then the team could not accomplish what it can do given the current deadline.

- **Listen to One Another.** The open feedback between team members was quite important. Not one individual dominated the conversation. Each team member contributed a solution that would be beneficial to the team and the project.

- **Capitalize on Each Other's Strengths.** A team member finds some way to do something, why not use it for our own indvidual activities? It definitely acknowledges that team member's contributions but implementing it also gives the other team members new tools to work with in our data science journey.

- **Have Fun.** This project was certainly fun. It was not a burden to develop a project solution. Each team member was happy to contribute something and to learn something new from his other team members.

A snapshot of our activities are listed below:

- **Week 1 - 9/2/2018.** Exploratory independent research to find out what data to use. Prepare individual findings for the group to discuss.
- **Week 2 - 9/9/2018.** Determined that the WW2 Allied Bombing data would be the primary data source for the team. Identified research questions to ask about the data.
- **Week 3 - 9/16/2018.** Soumya implemented the SQL scripts to upload the data to the team members' own MySQL databases. Jason demonstrated interesting mapping output based on the bomb data. Romerl developed some questions that the data could perhaps answer.
- **Week 4 - 9/23/2018.** Souyma, Jason, and Romerl continued to implement their own findings with the data.
- **Week 5 - 9/30/2018.** Souyma, Jason, and Romerl continued to implement their own findings with the data.
- **Week 6 - 10/7/2018.** Finalize outstanding tasks. Souyma continues to do final research on the project.  Jason would incorporate Map findings into final RMD document. Romerl will develop the preface, analysis, and summary documentation for the RMD files. All team members develop Individual Presentation Videos of 2 minutes each.
- **Week 7 - 10/14/2018.** Final touch-ups on project deliverables. Romerl merged all videos into one Master Video.
- **Week 8 - 10/21/2018.** Submit project deliverables and all components.

The RMD document will begin by showing how the data was uploaded into a MySQL database and how it could easily be queried from that point forward. This section will also give step-by-step instructions on how to upload the data onto a MySQL database and how to generate a DSN connection to the database vis Microsoft ODBC DSN. Next, some verification steps were executed to verify that the data can be queried easily, placed in data frames, and displayed using kable. Data Cleansing operations were executed to make the data useful for answering questions. The focus on this Project will be on the European and Pacific Theaters of Operations. However, some summary questions can be asked about the whole data set and this will be addressed. Using our combined knowledge of data cleansing, kable, tidy, dplyr, mapping technologies, etc. we developed some innovate answers to the following queries:

- Display a graph summarizing the Theaters of Operations
- Identifying the Target Countries by Mapping
- Display a graph showing the Top 10 Countries by Total Allied Bombing Missions
- Display a graph showing the Top 10 Countries by Total Bombing Tonnage
- Display a graph showing the Timeline of Aerial Bombing Operations by Total Allied Bombing Missions
- Data separation and cleansing of European (ETO) and Pacific (PTO) Theaters of Operations
- Display a graph showing the allocation of bombers used in ETO and PTO
- Display a graph showing the allocation of bombing tonnage used in ETO and PTO
- Display a graph showing Top 10 ETO Countries based on bombing tonnage
- Display a graph showing Top 10 PTO Countries based on bombing tonnage
- Display a graphs showing disperson of target countries for ETO and PTO by Total Allied Bombing Missions
- Display a line chart showing distribution of Explosives by Theater over Time
- Find out why the Philippines, an Allied country, not Japan, an Axis country, was the recipient of the most bombings in the PTO
- Display a map showing mass bombings (greater than 500) during particular dates in the ETO
- Display a map showing mass bombings (greater than 111) during particular dates in the PTO
- Display a map showing bombings by target type in the ETO
- Display a map showing bombings in the PTO
- Display a map showing locations of the heaviest bombing in the PTO
- Display a series of maps showing the progression of bombing advancement over a period of time on a specific target country in the PTO


### Data Title: World War II Theater History of Operations (THOR) Data
### Source: Data.World 

[Project Path](https://data.world/datamil/world-war-ii-thor-data) 

### Data Summary:

Theater History of Operations (THOR), is a painstakingly cultivated database of historic aerial bombings from World War I through Vietnam. The value of THOR is immense, and has already proven useful in finding unexploded ordinance in Southeast Asia and improving Air Force combat tactics. This dataset combines digitized paper mission reports from WWII. It can be searched by date, conflict, geographic location and more than 60 other data elements to form a live-action sequence of the air war from 1939 to 1945. The records include U.S. and Royal Air Force data, as well as some Australian, New Zealand and South African air force missions.

### Database Components:

#### This analysis involves a MySQL source database called 'ww2analysis'. This database has 3 tables -
##### 1. DimWeapon
##### 2. DimAirCraft
##### 3. AirBombingOps

**Note:** MySQL database software need to be installed in the local computer in order to successfully execute the R markdown code.

Below are the steps involved in preparing the MySQL DB environment necesaary for the R markdown code to run successfully -

#### **Step 1.** Run the DDL script mentioned below in order to create a database called 'ww2analysis' along with the necessary tables as mentioned above -

GitHub location:[DDL Script](https://raw.githubusercontent.com/RommyGraphs/MSDAGroups/master/DATA607/SQL%20Scripts/ww2analysis_DDL%20Script.sql) 

#### **Step 2.** Run the Bulk Data Load script to load necessary data into the database -

GitHub Location: [Bulk Load Script](https://raw.githubusercontent.com/RommyGraphs/MSDAGroups/master/DATA607/SQL%20Scripts/Bulk%20Data%20Upload%20Commands.txt)

**Note:** All the source CSV data files are also available in the below mention location -
GitHub Location: [Source Data Files](https://github.com/RommyGraphs/MSDAGroups/tree/master/DATA607/Source%20Data)

Alternatively, MySQL Database dump files can also be loaded from below location in order to set up the database locally to analyze this data set -

GitHub Location: [MySQL Dump Files](https://github.com/RommyGraphs/MSDAGroups/tree/master/DATA607/MySQL%20Data%20Dump)

#### **Step 3.** Create a ODBC System DSN called 'MySQL_WW2Analyis' in the local machine with 'ww2analysis' as the default database with appropriate root credentials or with an appropriate user id having READ access to 'ww2analysis' database.



### R Libraries:

Load necessary libraries -

```{r message=FALSE, warning=FALSE}
library(RODBC)
library(knitr)
library(kableExtra)
library(stringr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
library(plotly)
library(maps)
library(mapdata)
library(ggrepel) #not using this at the moment, but it does give the option to add labels.  While not useful for the 
```


### Database Connection and Processing:

Use an ODBC data source called 'MySQL_WW2Analyis' in order to connect to the database.

```{r dbConnect}
con <- odbcConnect("MySQL_WW2Analyis")
options(knitr.table.format = "html")
```


1.  Import data into R:

#### Table 1: World War II Allied Air Crafts:

```{r AirCraftTable}
aircraftDF <- as.data.frame(sqlFetch(con,"dimaircraft"),stringsAsFactors = FALSE)
aircraftDF %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% scroll_box(width="100%",height="300px")
```

#### Table 2: World War II Weapons:

```{r WeaponsTable}
weaponsDF <- as.data.frame(sqlFetch(con,"dimweapon"),stringsAsFactors = FALSE)
aircraftDF %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% scroll_box(width="100%",height="300px")
```

#### Table 3: World War II Aerial Bombing Missions:

```{r BombingMissionsTable}
tableWW2 <- tbl_df(as.data.frame(sqlFetch(con,"airbombingops"),stringsAsFactors = FALSE,na.strings=""))

glimpse(tableWW2) 

head(tableWW2, n=100) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% scroll_box(width="100%",height="300px")
```

### Data Cleasing Operations:

2.  Focus on selective fields useful for further analysis by removing highly sparsed columns:


```{r cleandataframe, eval=TRUE, message=FALSE, warning=FALSE}
tableWW2 <- tableWW2[, -which(names(tableWW2) %in% c("tgt_country_code","tgt_id","tgt_industry_code","source_latitude","source_longitude","mds","takeoff_latitude","takeoff_longitude","target_comment","mission_comments","source","database_edit_comments", "bda", "callsign", "rounds_ammo", "spares_return_ac","wx_fail_ac", "mech_fail_ac", "misc_fail_ac", "time_over_target","sighting_method_code","sighting_explanation"))]

### Replace BLANK theater values with NA
tableWW2$theater <- ifelse(tableWW2$theater == "","NA",str_trim(tableWW2$theater))

### Lookup table for theater names
lut <- c("MTO" = "Mediterranean Theater","PTO" = "Pacific Theater", "ETO" = "European Theater","CBI" = "China Burma India","EAST AFRICA" = "East Africa","MADAGASCAR" = "Madagascar","NA" = "Unknown")

tableWW2$theater_name <- lut[tableWW2$theater]

### Extract Mission Year and Month
tableWW2$Mission_Month <- substr(tableWW2$msndate,1,7)
tableWW2$Mission_Year <- substr(tableWW2$msndate,1,4)

### Format Target Country and Location 
tableWW2$tgt_country <- str_to_title(tableWW2$tgt_country)
tableWW2$tgt_location <- str_to_title(tableWW2$tgt_location)

```

**Analysis:** The main WW2 data frame extracted from the database contained a lot of information. Because of the limited scope of the project, it was decided that we excluded 22 columns from the data frame. Many of these columns were composed of blank data and some contained data that was not useful for this project. Upon cleaning the data we decided to add additional fields such as theater_name, Mission_Month, and Mission_Year as they would be important for further investigation of the data.

### Global Summary View of World War II Aerial Bombing Operations

3.  Summarizing the data by Theater of Operations:

European (ETO), Pacific(PTO) and Mediterranean(MTO) are the major theaters where aerial bombing operations were conducted. We have decided to focus on two primary theaters of operations ETO and PTO for further analysis.

```{r ThorSummary, fig.width = 10, fig.height = 6, message=FALSE, warning=FALSE}
theaterSummary <- tableWW2 %>% filter(theater != '') %>% group_by(theater_name) %>% summarise(Missions = n())

ggplot(theaterSummary, aes(x = reorder(theater_name, Missions),y= Missions/sum(Missions))) +
  geom_bar( stat = "identity", position = "dodge", fill = "blue") +
  geom_text(aes(label=percent(Missions/sum(Missions))), hjust=-0.2, color="black", position = position_dodge(0.9), size=3.5) +
  scale_y_continuous(labels=percent) +
  theme(axis.text.x=element_text(angle = 0, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("WWII Missions by Theater of Operations") +
  labs(x = "Theater of Operations",y = "% of Aerial Missions") +
  coord_flip()
```

**Analysis:** It was important to show a summary view of a percentage of total bombing missions by Theater of Operations by showing a horizontal Bar Chart. The graph shows that the European Theater encompasses the most bombing missions at 53.8% as compared to the rest of the theaters. Pacific and Mediterranean Theaters occupy a distant 2nd and 3rd respectively at 20.3% and 17.1%.

4.  Target Countries of WW II Aerial Bombing Operations -

```{r GlobalMissionDistribution, fig.width = 10, fig.height = 4, message=FALSE, warning=FALSE }
WorldData <- map_data('world')
WorldData %>% filter(region != "Antarctica") -> WorldData
WorldData <- fortify(WorldData)

sites <- tableWW2 %>% filter(theater != '') %>% group_by(tgt_country) %>% summarise(Missions = n(),Tons = sum(total_tons))

ggplot() + 
  geom_map(data=WorldData, map=WorldData,
           aes(x=long, y=lat, group=group, map_id=region),
           fill="white", colour="#7f7f7f", size=0.5) + 
  geom_map(data=sites, map=WorldData,
           aes(fill=Missions, map_id=tgt_country),
           colour="#7f7f7f", size=0.5) + 
  coord_map("rectangular", lat0=0, xlim=c(-180,180), ylim=c(-60, 90)) + 
  scale_fill_continuous(low="thistle2", high="darkred", guide="colorbar") + 
  scale_y_continuous(breaks=c()) + 
  scale_x_continuous(breaks=c()) + 
  labs(fill="Mission Count", title="Global View of the Aerial Bombing Missions", x="", y="") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  theme_bw() + 
  theme(panel.border = element_blank())
```

**Analysis:** From a different perspective, we wanted to show Total Aerial Bombing Missiongs by Target Countries using the ggplot's map technology. The resulting map shows the entire world minus Antarctica and colors the individual countries with a shade of red depending on the severity of the bombing. Based on the map, you can see that Germany has the deepest shade of red indicating that it was the receipt of the most bombings. The map is very informative from this aspect.

5.  Top 10 Countries on no. aerial bombing operations

```{r Top10Missions, fig.width = 8, fig.height = 6, message=FALSE, warning=FALSE}
topCountries <- sites %>% group_by(tgt_country) %>% summarise(Missions = sum(Missions)) %>% mutate(rank = rank(-Missions)) %>% filter(rank <= 10) %>% arrange(rank)

ggplot(topCountries, aes(x = reorder(tgt_country,-Missions), y = Missions)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "orange") + 
  geom_text(aes(label=Missions), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 45, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Top 10 Countries based on # of Aerial Bombing Missions") +
  labs(x = "Countries")
  
```

**Analysis:** Using the data we thus far, we used dplyr to summarize and rank the total number of missions by target country. To avoid clutteriness of the data, we only ranked the top 10 countries by total bombing missions executed against them. We displayed the results on a bar chart. As indicated in the previous map, Germany received more than 60,000 bombing missions and the next 2 countries Italy and France received approximately one-third of those bombing missions.


6.  Top 10 Countries based on no. total tons of explosives dropped:

```{r Top10ExposiveTons, fig.width = 8, fig.height = 6, message=FALSE, warning=FALSE}
topCountries <- sites %>% group_by(tgt_country) %>% summarise(Tons = sum(Tons)) %>% mutate(rank = rank(-Tons)) %>% filter(rank <= 10) %>% arrange(rank)

ggplot(topCountries, aes(x = reorder(tgt_country,-Tons), y = Tons)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "maroon") + 
  geom_text(aes(label=Tons), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 45, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Top 10 Countries based on Total Tons of Explosives Dropped") +
  labs(x = "Countries")
  
```

**Analysis:**  We used dplyr to summarize and rank the total bombing tonnage by target country. To avoid clutteriness of the data, we only ranked the top 10 countries by total bombing tonnage executed against them. We displayed the results on a bar chart. Similar to the previous bar chart, Germany, France, and Italy received the most bombing tonnage. Unliked the previous bar chart, it appears that France received half the bombing tonnage than Germany. France may have less than one-third of bombing missions than that of Germany, it still received half the bombing tonnage than that of Germany.

7.  Timeline of Aerial Bombing Operations:

```{r BombingTimeline, fig.width = 10, fig.height = 6, message=FALSE, warning=FALSE}
bomibngTimeline <- tableWW2 %>% group_by(Mission_Month) %>% summarise(Missions = n())

ggplot(bomibngTimeline, aes(x = Mission_Month, y = Missions)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "orange") + 
  #geom_text(aes(label=Missions), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Timeline of WW II Aerial Bombings") +
  labs(x = "Year-Months")
  
```

**Analysis:** Using dplyr to group the mission months for all WW2 missions, we developed a Bar-based timeline chart that shows the total number of bombs by month from the beginning to the end of World War 2. A dramatic increase in bombing missions starts on October 1943 and reaches its first maximum point in June 1944 and reaches its highest maximum point in April 1945. June 1944 could be an obvious choice as Allied Bombings increased substantially prior to D-Day, June 6, 1944, the Allied invasion of France. Moreover, several bombing missions were executed after D-Day to support the Allied breakout of the Normandy invasion area. April 1945 could be associated with the Allied bombing of major infrastructures in Germany. By this time, the Allied armies are in Germany ready to finish off its opponent. What is interesting to note by observing this chart, that bombing missions still occurred after World War 2 ended in September 1945. Observe some Allied bombings occurring in December 1945.

### European Vs. Pacific Theaters of Operations:

We wanted to focus our analysis towards the two most important theaters of actions.

8.  Separating data frame into two theaters: European and Pacific

```{r separatingdataframe, eval=TRUE, message=FALSE, warning=FALSE}
tableWW2ETO <- subset(tableWW2, theater == "ETO")
tableWW2PTO <- subset(tableWW2, theater == "PTO")
```

#### 8-A. Summmary for ETO Data Frame
```{r summarizedataframeETO, eval=TRUE, message=FALSE, warning=FALSE}
summary(tableWW2ETO)
```

#### 8-B. Summmary for PTO Data Frame
```{r summarizedataframePTO, eval=TRUE, message=FALSE, warning=FALSE}
summary(tableWW2PTO)
```

9.  Interesting Questions about Data:

### 9-A. What are the allocation of bombers used in ETO and PTO?

**European Theater:**

```{r aircraftdistributionETO, eval=TRUE, fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
ETOAircrafttype <- as.data.frame(table(tableWW2ETO$aircraft_name))
names(ETOAircrafttype) <- c("Aircraft", "Count")
ETOAircrafttype <- ETOAircrafttype[-which(ETOAircrafttype$Count == 0 ), ] # removing rows with 0 fields 
ggplot(ETOAircrafttype, aes(x = reorder(Aircraft, -Count), y = Count)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "green") +
  geom_text(aes(label=Count), vjust= -0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  ggtitle("ETO Aircraft Types")  +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Aircraft Type")
```

**Analysis:** Using the ETO data frame, we wanted to find out the Number of Allied of Missions by Bomber Type. This was useful because it showed what was the dominating aircraft used in the ETO missions. Based on the bar chart, we see that the United States of America had a large share of the bombing missions if you just look at the aircraft type alone. The top 3 mission counts by Aircraft Type are B17, B24, and B26 respectively and these aircraft types are American. 


**Pacific Theater:**

```{r aircraftdistributionPTO, eval=TRUE, fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PTOAircrafttype <- as.data.frame(table(tableWW2PTO$aircraft_name))
names(PTOAircrafttype) <- c("Aircraft", "Count")
PTOAircrafttype <- PTOAircrafttype[-which(PTOAircrafttype$Count == 0 ), ] # removing rows with 0 fields 
ggplot(PTOAircrafttype, aes(x = reorder(Aircraft, -Count), y = Count)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "red") +
  geom_text(aes(label=Count), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  ggtitle("PTO Aircraft Types")  +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Aircraft Type")
```

**Analysis:** Using the PTO data frame, we wanted to find out the Number of Allied of Missions by Bomber Type. This was useful because it showed what was the dominating aircraft used in the ETO missions. Based on the bar chart, we see that the United States of America had a monopoly of missions in the PTO. The majority of aircraft types in the PTO is American-made.

### 9-B.What are the allocation of tons of explosives of target countries in ETO and PTO?

**European Theater:**

```{r tonsexplosivescountrydistributionETO, eval=TRUE,fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}

#ETOExplosives <- tableWW2ETO[, which(names(tableWW2ETO) %in% c("tgt_country","total_tons"))]
#ETOExplosives <- ETOExplosives[!(is.na(ETOExplosives$total_tons) | ETOExplosives$total_tons==""), ]
#head(ETOExplosives, n=100)

tonsByCountriesETO <- tableWW2 %>% filter(theater == 'ETO') %>% group_by(tgt_country) %>% summarise(Tons = sum(total_tons))  %>% mutate(rank = rank(-Tons)) %>% filter(rank <= 10) %>% arrange(rank)

ggplot(tonsByCountriesETO, aes(x = reorder(tgt_country,-Tons), y = Tons)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "orange") + 
  geom_text(aes(label=Tons), vjust=-0.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 45, vjust = 0.5)) +
#  facet_wrap(~theater) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Top 10 Countries in ETO based on Total Tons of Explosives Dropped") +
  labs(x = "Countries", y = "Tons of Explosives")

```

**Analysis:** We used dplyr to summarize and rank the total bombing tonnage by target country for ETO only. To avoid clutteriness of the data, we only ranked the top 10 countries by total bombing tonnage executed against them. We displayed the results on a bar chart. Now things get interesting here. In the previous chart showing all total bombing tonnage by target countries, Germany, France, and Italy occupy the top 3 slots. However, in this chart, Germany, France, and Austira occupy the top 3 slots. What happened to Italy? Italy is in Europe. It turns out that the authors of the WW2 bombing data put Italy in the Mediterranean Theater of Operations (MTO). This certainly skews the data somewhat.

**Pacific Theater:**

```{r tonsexplosivescountrydistributionPTO, eval=TRUE,fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
tonsByCountriesPTO <- tableWW2 %>% filter(theater == 'PTO') %>% group_by(tgt_country) %>% summarise(Tons = sum(total_tons))  %>% mutate(rank = rank(-Tons)) %>% filter(rank <= 10) %>% arrange(rank)

ggplot(tonsByCountriesPTO, aes(x = reorder(tgt_country,-Tons), y = Tons)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "orange") + 
  geom_text(aes(label=Tons), vjust=-0.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 45, vjust = 0.5)) +
#  facet_wrap(~theater) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Top 10 Countries in PTO based on Total Tons of Explosives Dropped") +
  labs(x = "Countries", y = "Tons of Explosives")
```

**Analysis:** We used dplyr to summarize and rank the total bombing tonnage by target country for PTO only. To avoid clutteriness of the data, we only ranked the top 10 countries by total bombing tonnage executed against them. We displayed the results on a bar chart. As expected, Japan, an Axis country, is the receipient of the most bombing tonnage at 183,752. However, the Philippines, an Allied country occupied by Japan, is the recipient of the second most bombing tonnage at 62,679. Why is that? We will explain this later as we drill down to the Philippines.

### 9-C. What is the dispersion of target countries for either ETO and PTO?

**European Theater:**

```{r targetcountrydistributionETO, eval=TRUE, fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
ETOTCountry <- as.data.frame(table(tableWW2ETO$tgt_country))
names(ETOTCountry) <- c("Country", "Missions")
#ETOTCountry <- ETOTCountry[-which(ETOTCountry$Missions == 0 ), ] # removing rows with 0 fields 
ggplot(ETOTCountry, aes(x = reorder(Country, -Missions), y = Missions)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "blue") +
  geom_text(aes(label=Missions), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  ggtitle("ETO Missions by Target Country") + 
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Target Countries")
```

**Analysis:** We used dplyr to summarize and rank the total bombing missions by target country for ETO only. We displayed the results on a bar chart. Now things get interesting here. In the previous chart showing all total bombing missions by target countries, Germany, France, and Italy occupy the top 3 slots. However, in this chart, Germany, France, and Austira occupy the top 3 slots. What happened to Italy? Italy is in Europe. It turns out that the authors of the WW2 bombing data put Italy in the Mediterranean Theater of Operations (MTO). This certainly skews the data somewhat.

**Pacific Theater:**

```{r targetcountrydistributionPTO, eval=TRUE, fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PTOTCountry <- as.data.frame(table(tableWW2PTO$tgt_country))
names(PTOTCountry) <- c("Country", "Missions")
PTOTCountry <- PTOTCountry[-which(PTOTCountry$Missions <= 10 ), ] # removing rows with 0 fields 
ggplot(PTOTCountry, aes(x = reorder(Country, -Missions), y = Missions)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "blue") +
  geom_text(aes(label=Missions), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  ggtitle("PTO Missions by Target Country") + 
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Target Countries") 
```

**Analysis:** We used dplyr to summarize and rank the total bombing missions by target country for PTO only. We displayed the results on a bar chart. We expected Japan, an Axis country, to be the receipient of the most bombing missions. However, Japan is ranked 5. The Philippines is ranked 1st with the most bombing missions at 8180. Interesting: in terms of bombing tonnage, Japan ranks higher than the Philippines, but in terms of bombing missions, the Philippines ranks higher than Japan.

10. Does bombing tonnage increase for a specific period and for what theater?

**All Theaters:**

```{r tonsExplosivesOverTime, eval=TRUE,fig.width = 10, fig.height = 10, message=FALSE, warning=FALSE}

tonsByTheaterTime <- tableWW2 %>% group_by(theater_name,Mission_Month) %>% summarise(Tons = sum(total_tons)) %>% mutate(TonsK = Tons/1000)

ggplot(data=tonsByTheaterTime, aes(x=Mission_Month,y=TonsK, color=theater_name)) +
  geom_line(aes(group = theater_name))+
  geom_point()+
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  scale_fill_brewer(palette="Paired") + 
  ggtitle("Distribution of Explosives by Theater over Time") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom") +
  labs(y = "Tons of Explosives (in Thousands)")
```

**Analysis:** We used dplyr to summarize and rank the total bombing tonnage by month for all theaters. We displayed the results on a line chart. Based on the observations, we see that ETO bombing tonnage starts to become higher than all other theaters in March 1943. However, from November 1943 to April 1945, ETO bombing tonnage grows from less than 50,000 tons to greater than 300,000 tons. This certainly correlates with a step-up in Allied intervention in the ETO during that time period. The PTO bombing tonnage only starts to increase in November 1944 to its peak in August 1945. The PTO bombing tonnage for that time period went from approximately 6,000 tons to 60,000 tons. The PTO tonnage is substantially smaller than the ETO tonnage. Only the MTO bombing tonnage can compete with that of the PTO bombing tonnage. The MTO bombing tonnage has two peaks, one in May 1944 and the other in April 1945. Both periods had approximately 50,000 tons. 


11. As expected in ETO operations, Germany was the target country with the largest number of bombing missions. However, according to the PTO data, the Philippines was the target country with the largest number of bombing missions. Japan, an Axis opponent, had been the recipient of less than half of that of the Philippines. Why?

```{r Philippines-Data, eval=TRUE,fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PhilippinesDF <- tableWW2PTO[tableWW2PTO$tgt_country == "Philippine Islands",]
PbombingTimeline <- PhilippinesDF %>% group_by(Mission_Month) %>% summarise(Missions = n())

ggplot(PbombingTimeline, aes(x = Mission_Month, y = Missions)) + 
  geom_bar(stat = "identity", position = "dodge", fill = "red") + 
  #geom_text(aes(label=Missions), vjust=-0.5, color="black", position = position_dodge(0.9), size=3.5) +
  scale_fill_brewer(palette="Paired") + 
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Timeline of WW II Aerial Bombings - Philippines") +
  labs(x = "Year-Months")

```

**Analysis:** In this analysis, we wanted to focus exclusively in the Philippines. The Philippines has a greater number of bombing missions than that of Japan, an Axis country. We wanted to find out why. The best way to analyze this was to divide the total bombing missions by mission month. By using dplyr to sort the Philippine data by mission month, we could plot the results on a bar chart and see how and why the Philippines was the receipient of more bombing missions than Japan. We see in the timeline, the number of bombing missions starts to increase substantially starting on October 1944 and peaks for three consecutive months (March to May 1945). By looking at a list of battles in the Philippines during that time period, the uptick in bombing missions coincided with the preprations for the invasion of the Philippines by the United States. The Philippines was a territory of the United States and it was occupied by Japan at the beginning of the war. Wikipedia lists 15 battles in the Philippines from October 1944 and May 1945. During this time period, the United States successfully invaded and occupied the Philippines. Based on this observation, it could be concluded that Allied bombing precede or support a battle or raid. We will analyze this more when we show a map of bombings on specific dates.

12. Mass Bomb dates (bombings greater than 500) for ETO are 12/24/1944, 3/24/1945, 3/22/1945, and 6/6/1944. Why? Notice that Pre-Day bombardment dates are not Mass Bomb dates. Why?

```{r MassBombingDatesETO, eval=TRUE,fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
ETOclean<-tableWW2ETO[(tableWW2ETO$msndate == "1944-12-24" | tableWW2ETO$msndate == "1945-03-24" | tableWW2ETO$msndate == "1945-03-22" | tableWW2ETO$msndate == "1944-06-06"),]
ETOclean<-ETOclean[complete.cases(ETOclean),]

wm<-map_data("world")
sites<-data.frame(lat=ETOclean$latitude,long=ETOclean$longitude, stringsAsFactors = FALSE)
EuropeM<-ggplot() + geom_polygon(data = wm, aes(x=long, y = lat, group = group), fill = NA, color = "black") + coord_fixed(1.3)
EuropeM<-EuropeM+xlim(-7,30)+ylim(40,55)

BombDate1224<-subset(ETOclean,str_detect(ETOclean$msndate,"1944-12-24"))
BombDate0324<-subset(ETOclean,str_detect(ETOclean$msndate,"1945-03-24"))
BombDate0322<-subset(ETOclean,str_detect(ETOclean$msndate,"1945-03-22"))
BombDate0606<-subset(ETOclean,str_detect(ETOclean$msndate,"1944-06-06"))
EuropeM+geom_point(data=BombDate1224,aes(longitude,latitude),color="red",size=4)+
  geom_point(data=BombDate0324,aes(longitude,latitude),color="blue",size=4)+
  geom_point(data=BombDate0322,aes(longitude,latitude),color="orange",size=4)+
  geom_point(data=BombDate0606,aes(longitude,latitude),color="purple",size=4)

```

**Analysis:** On our initial summary of the WW2 bombing data, there were some interesting points in the data. It was found that during specific dates in the ETO: 6/6/1944, 12/24/1944, 3/22/1945, and 3/24/1945, there were greater than 500 bombing missions occurring on each of those dates. We wanted to find out why and where the bombings occuring during those dates. By subsetting the data to only include those dates, we wanted to include them in a map and find out their locations. We colored each date a specific color and found some interesting results:

- **6/6/1944:** Highlighted by the color purple, the majority of data points are at the Normandy area of France. 6/6/1944 is also famously known as D-Day, the Allied Invasion of France. The two other data points is in Eastern France and Belgium respectively. I believe the German 15th Army was located in Belgium at the time and the bombing point was close to the French city of Calais where the Germans believed the Allies would invade. A bombing run on that area would force the Germans to think the D-Day invasion would occur in that area. However, the several bombing points in the Normandy area seem to indicate an imminent invasion. If I were the German High Command, I would have focused on Normandy instead of Belgium based on the bombing data map.
- **12/24/1944:** Highlighted by the color red, the data points encompass one in southwest France, one in Poland, one in Luxembourg, and several in Germany [LIS]. What is intresting to note is the grid-like pattern bombing in the German area particulary in Southwest Germany.
- **3/22/1945:** Highlighted by the color orange, the data points encompass several in Germany, Austria, and Czechoslovkia. What is intresting to note is the grid-like pattern bombing in these areas.
- **3/24/1945:** Highlighted by the color blue, the data points encompass several in Germany and one in the Netherlands. Holland was not officially liberated until May 5, 1945, therefore, Allied bombing missions could still have been against German positions in the Netherlands [NET]. What is intresting to note is the grid-like pattern bombing in these areas.


13. Mass Bomb dates (bombings greater than 111) for PTO are 6/21, 5/13, 6/4, 3/13, 2/14, and 4/25 1945. Notice that the number of bombing missions for these dates are 1/4 the number than that of the ETO. Also, all mass bomb dates occurred in 1945. Why?

```{r MassBombingDatesPTO, eval=TRUE,fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PTOclean<-tableWW2PTO[(tableWW2PTO$msndate == "1945-06-21" | tableWW2PTO$msndate == "1945-05-13" | tableWW2PTO$msndate == "1945-06-04" | tableWW2PTO$msndate == "1945-03-13" | tableWW2PTO$msndate == "1945-02-14" | tableWW2PTO$msndate == "1945-04-25"),]
PTOclean<-PTOclean[complete.cases(PTOclean),]

wm2<-map_data("world")
sites<-data.frame(lat=PTOclean$latitude,long=PTOclean$longitude, stringsAsFactors = FALSE)
PacificM<-ggplot() + geom_polygon(data = wm2, aes(x=long, y = lat, group = group), fill = NA, color = "black") + coord_fixed(1.3)
PacificM<-PacificM+xlim(105,150)+ylim(-10,40)

BombDate0621<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-06-21"))
BombDate0513<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-05-13"))
BombDate0604<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-06-04"))
BombDate0313<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-03-13"))
BombDate0214<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-02-14"))
BombDate0425<-subset(PTOclean,str_detect(PTOclean$msndate,"1945-04-25"))
PacificM+geom_point(data=BombDate0621,aes(longitude,latitude),color="red",size=4)+
  geom_point(data=BombDate0513,aes(longitude,latitude),color="blue",size=4)+
  geom_point(data=BombDate0604,aes(longitude,latitude),color="orange",size=4)+
  geom_point(data=BombDate0313,aes(longitude,latitude),color="purple",size=4)+
  geom_point(data=BombDate0214,aes(longitude,latitude),color="yellow",size=4)+
  geom_point(data=BombDate0425,aes(longitude,latitude),color="green",size=4)
```

**Analysis:** On our initial summary of the WW2 bombing data, there were some interesting points in the data. It was found that during specific dates in the PTO: 2/14/1945, 3/13/1945, 4/25/1945, 5/13/1945, 6/4/1945, and 6/21/1945, there were greater than 111 bombing missions occurring on each of those dates. We wanted to find out why and where the bombings occuring during those dates. By subsetting the data to only include those dates, we wanted to include them in a map and find out their locations. We colored each date a specific color and found some interesting results.

- **2/14/1945:** Highlighted by the color yellow, the data points encompass several bombings in Japan, Philippines, and other places. This date is not significant but during that period, the United States was in the Battle of Manila and attempting to occupy the rest of the Philippines [MIL]. Japan was the receipient of several bombings by the United States during this period.
- **3/13/1945:** Highlighted by the color purple, the data points encompass bombings in Taiwan, one in Japan, and other places. What is significant about the one in Japan, is that 274 US bombers leveled Osaka on this date [BOM]. Literature review does not indicate why Taiwan received special attention on this date.
- **4/25/1945:** Highlighted by the color green, the data points encompass several bombings in the Philippines and Japan, and other places.  Japan was the receipient of several bombings by the United States during this period.There are a lot of bombing points in the main Philippine island of Luzon, but the literature review does not find indicate why Luzon received special attention on this date.
- **5/13/1945:** Highlighted by the color blue, the data points encompass bombings in the Philippines, Vietnam, and other places. While there is no relevant information based on literature review why Vietname received special attention on this date, Japan did take over this area in March [FRE]. Perhaps the Japanese occupation of the area invited subsequent bombings by the Allies.
- **6/4/1945:** Highlighted by the color orange, the data points encompass bombings in the Philippines and New Guinea. Several battles in the Philippines were being fought by the United States during that period.
- **6/21/1945:** Highlighted by the color red, the data points encompass bombings in several places in the PTO with no specific concentrations.

### Map-Specific Questions of the Data


```{r separatingdataframeCBIMTO, eval=TRUE, include=FALSE, message=FALSE, warning=FALSE}
tableWW2CBI <- subset(tableWW2, theater == "CBI")
tableWW2MTO <- subset(tableWW2, theater == "MTO")
```

Related questions to initial questions indicated above, some map-specific questions were found to be intriguing:

1.) What sorts of places were bombed in the European Theater?  

2.) What was bombing like in the Pacific Theater?

3.) How can we look at the locations of the heaviest bombings in the Pacific?  

4.) How can we see the progression of bombing advancement and targetting?

We have countries and coordinates, but no real way of seeing what was happening.  If we map the locations, we can see the story of the bombings unfold.

14.  What sorts of places were bombed in the European Theater?  

First, what sorts of targets were bombed in Europe?  The most numerous types of targets were airfields and related facilities, cities, oil production and storage, and railroad facilities.  We can take a look at some of the most heavily bombed cities in the war and the targets around them.

```{r fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
EuropeCities<-data.frame("LONGITUDE"=c(2.4,4.9,10,13.7),"LATITUDE"=c(48.9,52.3,53.5,51),"CITY"=c("Paris","Amsterdam","Hamburg","Dresden"))
ETOsites<-tableWW2ETO[,9:12]
ETOclean<-ETOsites[complete.cases(ETOsites),]
Targets<-ETOsites$TGT_TYPE
wm<-map_data("world")
sites<-data.frame(lat=ETOclean$latitude,long=ETOclean$longitude, stringsAsFactors = FALSE)
EuropeM<-ggplot() + geom_polygon(data = wm, aes(x=long, y = lat, group = group), fill = NA, color = "black") + coord_fixed(1.3)
EuropeM<-EuropeM+xlim(-5,17)+ylim(42,57)
Airfield<-subset(ETOclean,str_detect(ETOclean$tgt_type,"AIR"))
Airfield$tgt_type <- "Airfields/Hangers"
City<-subset(ETOclean,str_detect(ETOclean$tgt_type,"CITY"))
City$tgt_type<-"Cities"
oil<-subset(ETOclean,str_detect(ETOclean$tgt_type,"OIL"))
oil$tgt_type<-"Oil Production and Storage"
Railyard<-subset(ETOclean,ETOclean$tgt_type=="MARSHALLING YARD")
Railyard$tgt_type<-"Railroad Facilities"
EuropeTargets<-rbind(rbind(rbind(City,Airfield),oil),Railyard)
EuropeM+geom_point(data=EuropeTargets,aes(x=longitude,y=latitude,color=tgt_type))+labs(color="Target Type")+theme_bw()+geom_label_repel(data = EuropeCities, aes(LONGITUDE, LATITUDE, label = CITY), size = 3,nudge_y = 4)
```

**Analysis:** By looking at this map, we can see the major cities occupied were bombed heavily, additionally, airbases that could hit Britain were targeted.  Dresden and Hamburg were both hit heavily with firebombing, although strategically around them, the only targets were oil production facilities.  

15. What was bombing like in the Pacific Theater?

In the Pacific, as the other two showed, the most heavily bombed country was the Philippines, not Japan.  What becomes interesting is not the types of targets, but when they occured and how many bombs were dropped.

First, we can get an overview of the bombing in the Pacific.As you can see, bombings occurred all over the Pacific theater.

```{r fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PacificM<-ggplot() + geom_polygon(data = wm, aes(x=long, y = lat, group = group), fill = NA, color = "black") + coord_fixed(1.3)
PacificM<-PacificM+xlim(74,175)+ylim(-15,50)
PTOSites<-tableWW2PTO[,c(3,8,9,10,11,12,14,22:33,43)]
philtargets <- subset(tableWW2PTO, tgt_country == "Philippine Islands")
PacificM+geom_point(data=PTOSites,aes(longitude,latitude),color="red",size=.5)+theme_bw()
```

16. How can we look at the locations of the heaviest bombings in the Pacific?  

The outlines of the Philippines are essentially completely covered by the bombing locations.  Zooming in on the Philippines, we can now check the most heavily bombed targets. The larger the circles, the bombings are more frequent. The smaller the circles, the bombings are less frequent. As you can observe, the city Manily received special attention during the bombing campaign.


```{r fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
PhilippinesMap<-ggplot() + geom_polygon(data = wm, aes(x=long, y = lat, group = group), fill = NA, color = "black") + coord_fixed(1.3)+xlim(114,128)+ylim(2,21)
```

```{r fig.width = 10, fig.height = 7, message=FALSE, warning=FALSE}
library(lubridate)
library(plyr)
Philcity<-data.frame("longitude"=c(121),"latitude"=c(14.6),"city"=c("Manilla"))
philtargetsfreq<-ddply(philtargets,.(longitude,latitude),nrow)#this is creating a data.frame with three columns, longituded, latitude and v1, which is the number of times each set of values appeared.  This is in plyr, but not dplyr, the command for it is different there.
philtargetsfinal<-merge(philtargets,philtargetsfreq) #attaching the number of occurences to the target list
PHnumdate<-as.numeric(mdy(philtargetsfinal[,5])) #turning the date into a number that can be used
PHnumdatepos<-PHnumdate+21184
PHYear<-floor(PHnumdatepos/365)
PHYearReal<-PHYear+1912
philtargetsfinal2<-cbind(philtargetsfinal,PHYearReal)
ggplot()+geom_point(data=philtargetsfinal2,aes(longitude,latitude),color="red",size=log(philtargetsfinal2$V1,4))+geom_polygon(data = wm, aes(x=long, y = lat, group = group), fill = NA, color = "black") +coord_fixed(1.3)+xlim(114,128)+ylim(2,21)+geom_label_repel(data = Philcity, aes(longitude, latitude, label = city), size = 3,nudge_x = -4)+theme_bw()
```

This shows us that the area around Manila was incredibly heavily bombed, but does not tell us when.  

17. How can we see the progression of bombing advancement and targetting?

We can finally look at the progression of American bombing during the war. As you can see from the maps below, bombings start to proliferate in the years 1944 and 1945. 

```{r fig.width = 10, fig.height = 14, message=FALSE, warning=FALSE}
#PhilippinesMap+geom_point(data=philtargetsfinal2,aes(longitude,latitude),size=.5,color="red")+theme_bw()+facet_wrap(~PHYearReal)
PhilippinesMap+geom_point(data=philtargetsfinal2,aes(longitude,latitude),size=.5,color="red")+theme_bw()+facet_wrap(~Mission_Year)
```

### References

**[BOM] Bombing of Tokyo and Other Cities.** Retrieved from website: https://ww2db.com/battle_spec.php?battle_id=217

**[FRE] French Indochina in World War II.** Retried from website: https://en.wikipedia.org/wiki/French_Indochina_in_World_War_II

**[LIS] List of Air Operations during the Battle of Europe.** Retrieved from website: https://en.wikipedia.org/wiki/List_of_air_operations_during_the_Battle_of_Europe

**[MIL] Military History of the Philippines during World War II.** Retrieved from website: https://en.wikipedia.org/wiki/Military_history_of_the_Philippines_during_World_War_II

**[NET] Netherlands in World War II.** Retrieved from website: https://en.wikipedia.org/wiki/Netherlands_in_World_War_II#Liberation

